CREATE TABLE EMPLEADOS (
    ID_EMPLEADO NUMBER PRIMARY KEY,
    NOMBRE VARCHAR2(100),
    APELLIDO VARCHAR2(100),
    SALARIO NUMBER,
    DIRECCION VARCHAR2(255),
    DEPARTAMENTO_ID NUMBER
);

INSERT INTO EMPLEADOS (ID_EMPLEADO, NOMBRE, APELLIDO, SALARIO, DIRECCION, DEPARTAMENTO_ID)
VALUES (101, 'Juan', 'Pérez', 4000, 'Calle Vieja 456', 10);

INSERT INTO EMPLEADOS (ID_EMPLEADO, NOMBRE, APELLIDO, SALARIO, DIRECCION, DEPARTAMENTO_ID)
VALUES (102, 'Ana', 'Gómez', 6000, 'Avenida Central 789', 20);

INSERT INTO EMPLEADOS (ID_EMPLEADO, NOMBRE, APELLIDO, SALARIO, DIRECCION, DEPARTAMENTO_ID)
VALUES (103, 'Luis', 'Martínez', 8000, 'Boulevard Norte 123', 30);

COMMIT;

CREATE TABLE AUDITORIA_DIRECCIONES (
    ID_AUDITORIA NUMBER PRIMARY KEY,
    ID_EMPLEADO NUMBER,
    DIRECCION_ANTERIOR VARCHAR2(255),
    NUEVA_DIRECCION VARCHAR2(255),
    FECHA_CAMBIO DATE DEFAULT SYSDATE,
    CAMBIADO_POR VARCHAR2(100)
);


CREATE SEQUENCE SEQ_AUDITORIA_DIRECCIONES
START WITH 1
INCREMENT BY 1
NOCACHE;

CREATE OR REPLACE TRIGGER trg_auto_id_auditoria
BEFORE INSERT ON AUDITORIA_DIRECCIONES
FOR EACH ROW
BEGIN
    IF :NEW.ID_AUDITORIA IS NULL THEN
        :NEW.ID_AUDITORIA := SEQ_AUDITORIA_DIRECCIONES.NEXTVAL;
    END IF;
END;
/


--prueba--

INSERT INTO AUDITORIA_DIRECCIONES (ID_EMPLEADO, DIRECCION_ANTERIOR, NUEVA_DIRECCION, CAMBIADO_POR)
VALUES (101, 'Calle Vieja 456', 'Calle Nueva 123', 'HR_ADMIN');

INSERT INTO AUDITORIA_DIRECCIONES (ID_EMPLEADO, DIRECCION_ANTERIOR, NUEVA_DIRECCION, CAMBIADO_POR)
VALUES (102, 'Avenida Central 789', 'Avenida Sur 456', 'HR_ADMIN');


SELECT * FROM AUDITORIA_DIRECCIONES;
